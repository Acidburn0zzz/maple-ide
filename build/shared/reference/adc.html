

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ADC &mdash; Maple v0.0.9 Documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/breathe.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/round_logo_32x32.ico"/>
    <link rel="top" title="Maple v0.0.9 Documentation" href="index.html" />
    <link rel="next" title="SPI" href="spi.html" />
    <link rel="prev" title="JTAG" href="jtag.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="spi.html" title="SPI"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="jtag.html" title="JTAG"
             accesskey="P">previous</a> |</li>
    <li><a href="http://leaflabs.com">LeafLabs</a> |</li>
    <li><a href="index.html">Docs Home</a> |</li>
    
        <li><a href="index.html">Index</a> &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="adc">
<span id="id1"></span><h1>ADC<a class="headerlink" href="#adc" title="Permalink to this headline">¶</a></h1>
<p>Analog-Digital Conversion is the process of reading a physical voltage
as a number. The Maple has a large number of pins which are capable of
taking 12-bit ADC measurements, which means that voltages from ground
to +3.3v are read as numbers from 0 to 4095; this corresponds to a
theoretical sensitivity of just under 1 millivolt. In reality, a
number of factors introduce noise and bias into this reading and a
number of techniques must be used to get good precision and accuracy.</p>
<div class="compound">
<p class="compound-first">The header pins with ADC functionality (marked as &#8220;AIN&#8221; on the
silkscreen) are:</p>
<blockquote class="compound-middle">
D0, D1, D2, D3, D10, D11, D12, D13, D15, D16, D17, D18, D19, D20, D27, D28</blockquote>
<p class="compound-last">Note that pins 3, 27, and 28 are not marked AIN on the silkscreen
for Maple revisions through Rev 5, however, they <strong>do work</strong> as
analog input pins.</p>
</div>
<div class="contents local topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#noise-and-bias" id="id2">Noise and Bias</a></li>
<li><a class="reference internal" href="#function-reference" id="id3">Function Reference</a></li>
<li><a class="reference internal" href="#recommended-reading" id="id4">Recommended Reading</a></li>
</ul>
</div>
<div class="section" id="noise-and-bias">
<span id="adc-noise-bias"></span><h2><a class="toc-backref" href="#id2">Noise and Bias</a><a class="headerlink" href="#noise-and-bias" title="Permalink to this headline">¶</a></h2>
<p>The biggest issues with analog-digital conversion are noise and bias.
With the Maple, we have tried to isolate the ADC pins and traces from
strong noise sources but there are always trade&#8211;offs between noise,
additional functionality, cost, and package size.</p>
<p>The 6 ADC pins in a bank (D15&#8211;D20) generally have the least
noise and should be used for fine measurements.  If the input voltage
changes relatively slowly, a number of samples can be taken in
succession and averaged together, or the same voltage can even be
sampled by multiple ADC pins at the same time.</p>
<p>An important factor when taking a voltage reading is the reference
voltages that the sample is being compared against. In the case of the
Maple, the high reference is V<sub>cc</sub> and the low reference is ground.
This means that noise or fluctuations on either V<sub>cc</sub> or ground will
affect the measurement. It also means that the voltage you are trying
to sample must be between ground and 3.3V. In the case of a variable
reading, it is best if the voltage varies over the entire range of
0&#8211;3.3V; otherwise, only a fraction of the sensitivity is being
leveraged.  Resistor dividers and constant voltage diodes are basic
tools which can help bring a given voltage signal into the appropriate
range; opamps and other powered components can also be used.</p>
</div>
<div class="section" id="function-reference">
<span id="adc-function-reference"></span><h2><a class="toc-backref" href="#id3">Function Reference</a><a class="headerlink" href="#function-reference" title="Permalink to this headline">¶</a></h2>
<dt id=""><span id="project0io_8h_1a781eb70553f24a8e2f730941fe754caf"></span>uint32  <strong>analogRead</strong>(uint8 pin)</dt>
<dd><p class="first">
<p>Read an analog value from pin. </p>
        </p>
<p class="last">
<p>This function blocks during ADC conversion, and has 12 bits of resolution. The pin must have its mode set to INPUT_ANALOG. Ignoring function call overhead, conversion time is 55.5 cycles.</p>
<p><p><em>Parameters</em></p>
<ul class="breatheparameterlist">
<li><tt class="first docutils literal"><span class="pre">pin</span></tt> - 
<p>Pin to read from. One of: 0, 1, 2, 3, 10, 11, 12, 13, 15, 16, 17, 18, 19, 20, 27, 28.</p>
</li>
</ul>



<dl class="docutils">
<dt><em>Return</em></dt>
<dd>ADC-converted voltage, in the range 0&#8211;4095, inclusive (i.e. a 12-bit ADC conversion).</dd>
<dt><em>See</em></dt>
<dd><a class="reference internal" href="lang/api/pinmode.html#project0io_8h_1ae4c31233dfda1c1f966e3665b9cbd98c"><em>pinMode()</em></a> </dd>
</dl>
</p>
        </p>
</dd>
<dt id=""><span id="project0io_8h_1ae4c31233dfda1c1f966e3665b9cbd98c"></span>void  <strong>pinMode</strong>(uint8 pin, <a class="reference internal" href="lang/api/pinmode.html#project0io_8h_1a3e6ca6f0b3c7bbe79de5d3ec07877da1"><em>WiringPinMode</em></a> mode)</dt>
<dd><p class="first">
<p>Configure behavior of a GPIO pin. </p>
        </p>
<p class="last">
<p><p><em>Parameters</em></p>
<ul class="breatheparameterlist">
<li><tt class="first docutils literal"><span class="pre">pin</span></tt> - 
<p>Pin to configure. One of: 0-38 (pin numbers as labeled on silkscreen), or D0-D38 (symbols for same) </p>
</li>
<li><tt class="first docutils literal"><span class="pre">mode</span></tt> - 
<p>Mode corresponding to desired pin behavior. </p>
</li>
</ul>


<dl class="docutils">
<dt><em>See</em></dt>
<dd><a class="reference internal" href="lang/api/pinmode.html#project0io_8h_1a3e6ca6f0b3c7bbe79de5d3ec07877da1"><em>WiringPinMode</em></a> </dd>
</dl>
</p>
        </p>
</dd>
<dt id=""><span id="project0io_8h_1a3e6ca6f0b3c7bbe79de5d3ec07877da1"></span><strong>WiringPinMode enum</strong></dt>
<dd><p class="first">
<p>Specifies a GPIO pin behavior. </p>
        </p>
<p>
<p>Each of the GPIO pins on a Maple board may be configured using <a class="reference internal" href="lang/api/pinmode.html#project0io_8h_1ae4c31233dfda1c1f966e3665b9cbd98c"><em>pinMode()</em></a> to behave in a number of ways: as a digital output pin, or as an analog input pin, etc., depending on the particular pin.</p>
<p>This enum specifies the complete set of possible configurations; not every pin can have all of these modes. For example, on the Maple, pin 15 may be configured as INPUT_ANALOG, but not as PWM. See your device&#8217;s silkscreen and and the GPIO documentation for more information.</p>
<p>
<dl class="docutils">
<dt><em>See</em></dt>
<dd><a class="reference internal" href="lang/api/pinmode.html#project0io_8h_1ae4c31233dfda1c1f966e3665b9cbd98c"><em>pinMode()</em></a> </dd>
</dl>
</p>
        </p>
<p><em>Values:</em></p>
<ul class="breatheenumvalues last">
<li><tt class="first docutils literal"><span class="pre">OUTPUT</span></tt> - 
<p>Basic digital output: when the pin is HIGH, the voltage is held at +3.3v (Vcc) and when it is LOW, it is pulled down to ground. </p>
          
          </li>
<li><tt class="first docutils literal"><span class="pre">OUTPUT_OPEN_DRAIN</span></tt> - 
<p>In open drain mode, the pin indicates &#8220;low&#8221; by accepting current flow to ground and &#8220;high&#8221; by providing increased impedance. </p>
          
<p>An example use would be to connect a pin to a bus line (which is pulled up to a positive voltage by a separate supply through a large resistor). When the pin is high, not much current flows through to ground and the line stays at positive voltage; when the pin is low the bus &#8220;drains&#8221; to ground with a small amount of current constantly flowing through the large resistor from the external supply. In this mode no current is ever actually /sourced/ from the pin. </p>
          </li>
<li><tt class="first docutils literal"><span class="pre">INPUT</span></tt> - 
<p>Basic digital input. </p>
          
<p>The pin voltage is sampled; when it is closer to 3.3v (Vcc) the pin status is high, and when it is closer to 0v (ground) it is low. If no external circuit is pulling the pin voltage to high or low, it will tend to randomly oscillate and be very sensitive to noise (e.g., a breath of air across the pin might cause the state to flip). </p>
          </li>
<li><tt class="first docutils literal"><span class="pre">INPUT_ANALOG</span></tt> - 
<p>This is a special mode for when the pin will be used for analog (not digital) reads. </p>
          
<p>Enables ADC conversion to be performed on the voltage at the pin. </p>
          </li>
<li><tt class="first docutils literal"><span class="pre">INPUT_PULLUP</span></tt> - 
<p>The state of the pin in this mode is reported the same way as with INPUT, but the pin voltage is gently &#8220;pulled up&#8221; towards +3.3v. </p>
          
<p>This means the state will be high unless an external device is specifically pulling the pin down to ground, in which case the &#8220;gentle&#8221; pull up will not affect the state of the input. </p>
          </li>
<li><tt class="first docutils literal"><span class="pre">INPUT_PULLDOWN</span></tt> - 
<p>The state of the pin in this mode is reported the same way as with INPUT, but the pin voltage is gently &#8220;pulled down&#8221; towards 0v. </p>
          
<p>This means the state will be low unless an external device is specifically pulling the pin up to 3.3v, in which case the &#8220;gentle&#8221; pull down will not affect the state of the input. </p>
          </li>
<li><tt class="first docutils literal"><span class="pre">INPUT_FLOATING</span></tt> - 
<p>Synonym for INPUT. </p>
          
          </li>
<li><tt class="first docutils literal"><span class="pre">PWM</span></tt> - 
<p>This is a special mode for when the pin will be used for PWM output (a special case of digital output). </p>
          
          </li>
<li><tt class="first docutils literal"><span class="pre">PWM_OPEN_DRAIN</span></tt> - 
<p>Like PWM, except that instead of alternating cycles of LOW and HIGH, the voltage on the pin consists of alternating cycles of LOW and floating (disconnected). </p>
          
          </li>
</ul>
</dd>
</div>
<div class="section" id="recommended-reading">
<span id="adc-recommended-reading"></span><h2><a class="toc-backref" href="#id4">Recommended Reading</a><a class="headerlink" href="#recommended-reading" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Analog-to-digital_converter">Wikipedia article on Analog-to-digital converter</a></li>
<li><a class="reference external" href="http://arduino.cc/en/Tutorial/AnalogInputPins">Arduino Analog Input Tutorial</a></li>
<li>STMicro documentation for STM32F103RB microcontroller:<ul>
<li><a class="reference external" href="http://www.st.com/mcu/devicedocs-STM32F103RB-110.html">All</a></li>
<li><a class="reference external" href="http://www.st.com/stonline/products/literature/ds/13587.pdf">Datasheet</a> (pdf)</li>
<li><a class="reference external" href="http://www.st.com/stonline/products/literature/rm/13902.pdf">Reference Manual</a> (pdf)</li>
<li><a class="reference external" href="http://www.st.com/stonline/products/literature/an/16840.pdf">Application Note on ADC Modes (pdf)</a></li>
<li><a class="reference external" href="http://www.st.com/stonline/products/literature/an/14183.pdf">Application Note on ADC Oversampling (pdf)</a></li>
</ul>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/round_logo_60x60.png" alt="Logo"/>
            </a></p>
<h3><a href="index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="maple-quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="maple-ide-install.html">IDE Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ide.html">IDE Anatomy</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="language.html">Maple Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="libraries.html">Maple Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="compatibility.html">Arduino Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="external-interrupts.html">External Interrupts</a></li>
<li class="toctree-l1"><a class="reference internal" href="libmaple.html">Command-Line Tools &amp; APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootloader.html">Bootloader</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="errata.html">Known Problems</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="i2c.html">I<sup>2</sup>C</a></li>
<li class="toctree-l1"><a class="reference internal" href="pwm.html">PWM</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpio.html">GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="usb.html">USB</a></li>
<li class="toctree-l1"><a class="reference internal" href="jtag.html">JTAG</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="spi.html">SPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="usart.html">USART</a></li>
<li class="toctree-l1"><a class="reference internal" href="timers.html">Timers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="specs.html">Technical Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="language-index.html">Complete Language Index</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="spi.html" title="SPI"
             >next</a></li>
        <li class="right" >
          <a href="jtag.html" title="JTAG"
             >previous</a> |</li>
    <li><a href="http://leaflabs.com">LeafLabs</a> |</li>
    <li><a href="index.html">Docs Home</a> |</li>
    
        <li><a href="index.html">Index</a> &raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, LeafLabs, LLC.
      Last updated on Dec 21, 2010.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>
  </body>
</html>