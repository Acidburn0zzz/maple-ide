

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>External Interrupts &mdash; Maple v0.0.9 Documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/breathe.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/round_logo_32x32.ico"/>
    <link rel="top" title="Maple v0.0.9 Documentation" href="index.html" />
    <link rel="next" title="libmaple Reference" href="libmaple.html" />
    <link rel="prev" title="Maple-Arduino Compatibility" href="compatibility.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="libmaple.html" title="libmaple Reference"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="compatibility.html" title="Maple-Arduino Compatibility"
             accesskey="P">previous</a> |</li>
    <li><a href="http://leaflabs.com">LeafLabs</a> |</li>
    <li><a href="index.html">Docs Home</a> |</li>
    
        <li><a href="index.html">Index</a> &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="external-interrupts">
<span id="id1"></span><h1>External Interrupts<a class="headerlink" href="#external-interrupts" title="Permalink to this headline">¶</a></h1>
<p>External interrupts can be used to trigger routines to run in response
to changes in voltage on a pin. Each GPIO pin on the Maple can be used
to detect transitions such as when the voltage goes from low to high,
or from high to low. This technique can be used to avoid unnecessary
polling of the state of a pin.</p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>External interrupts are often used to detect when events happen
outside of the microcontroller. These can be used to tell the Maple
when events happen, such as when a sensor has data ready to be read,
or when a button has been pushed. When such an event happens, an
interrupt is raised and the Maple can react to it with a preset
<em>interrupt handler</em>.</p>
<p>Every GPIO pin on the Maple can be used as an external interrupt,
subject to certain constraints; there can be a maximum of 16 different
external interrupts set up at a time on the Maple. This is because the
external interrupt lines on the STM32 are multiplexed between GPIO
ports. In effect, this means that every pin on the Maple maps to a
certain EXTI line, and within that EXTI line, only one of the pins
that maps to it can be used as an external interrupt at a time.</p>
<p>The following table shows which pins can be used on which lines.</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">EXTI Line</th>
<th class="head">Maple pins</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>EXTI0</td>
<td>2, 15, 27</td>
</tr>
<tr><td>EXTI1</td>
<td>3, 16, 28</td>
</tr>
<tr><td>EXTI2</td>
<td>1, 17, 25</td>
</tr>
<tr><td>EXTI3</td>
<td>0, 18</td>
</tr>
<tr><td>EXTI4</td>
<td>10, 19</td>
</tr>
<tr><td>EXTI5</td>
<td>4, 13, 20</td>
</tr>
<tr><td>EXTI6</td>
<td>5, 12, 35</td>
</tr>
<tr><td>EXTI7</td>
<td>9, 11, 36</td>
</tr>
<tr><td>EXTI8</td>
<td>6, 14, 37</td>
</tr>
<tr><td>EXTI9</td>
<td>7, 25, 28</td>
</tr>
<tr><td>EXTI10</td>
<td>8, 26, 29</td>
</tr>
<tr><td>EXTI11</td>
<td>30</td>
</tr>
<tr><td>EXTI12</td>
<td>31</td>
</tr>
<tr><td>EXTI13</td>
<td>21, 32</td>
</tr>
<tr><td>EXTI14</td>
<td>22, 33</td>
</tr>
<tr><td>EXTI15</td>
<td>23, 34</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You should set the <a class="reference internal" href="lang/api/pinmode.html#lang-pinmode"><em>pin mode</em></a> of your
desired pin to an input mode (e.g <tt class="docutils literal"><span class="pre">INPUT</span></tt> or <tt class="docutils literal"><span class="pre">INPUT_FLOATING</span></tt>,
<tt class="docutils literal"><span class="pre">INPUT_PULLUP</span></tt>, <tt class="docutils literal"><span class="pre">INPUT_PULLDOWN</span></tt>).</p>
</div>
</div>
<div class="section" id="function-reference">
<h2>Function Reference<a class="headerlink" href="#function-reference" title="Permalink to this headline">¶</a></h2>
<dt id=""><span id="project0class_hardware_timer_1ae1965408f7b2ed72eaf37f35590a1e36"></span>void  <strong>attachInterrupt</strong>(int channel, voidFuncPtr handler)</dt>
<dd><p class="first">
<p>Attach an interrupt handler to the given channel. </p>
        </p>
<p class="last">
<p>This interrupt handler will be called when the timer&#8217;s counter reaches the given channel compare value.</p>
<p>The argument should be a function which takes no arguments and has no return value; i.e. it should have signature</p>
<p>void (*handler)(void);</p>
<p>Note: The function (often called an interrupt service routine, or ISR) should attempt to return as quickly as possible. Blinking the LED, some logic, PWM updates, and Serial writes are fine; writing to SerialUSB or waiting for user input can take a long time and other compare interrupts won&#8217;t fire. Tip: if you have a <a class="reference internal" href="lang/api/delay.html#project0time_8h_1a6bc5f943544a887f8b23cadfb26a5e30"><em>delay()</em></a> in your interrupt routine, you&#8217;re probably doing it wrong.</p>
<p><p><em>Parameters</em></p>
<ul class="breatheparameterlist">
<li><tt class="first docutils literal"><span class="pre">channel</span></tt> - 
<p>the channel to attach the ISR to, from 1 to 4. </p>
</li>
<li><tt class="first docutils literal"><span class="pre">handler</span></tt> - 
<p>The ISR to attach to the given channel. </p>
</li>
</ul>


<dl class="docutils">
<dt><em>See</em></dt>
<dd>voidFuncPtr </dd>
</dl>
</p>
        </p>
</dd>
<dt id=""><span id="project0class_hardware_timer_1a4c3c9587c7e489ebbe90478e99558ec1"></span>void  <strong>detachInterrupt</strong>(int channel)</dt>
<dd><p class="first">
<p>Remove the interrupt handler attached to the given channel, if any. </p>
        </p>
<p class="last">
<p>The handler will no longer be called by this timer.</p>
<p><p><em>Parameters</em></p>
<ul class="breatheparameterlist">
<li><tt class="first docutils literal"><span class="pre">channel</span></tt> - 
<p>the channel whose interrupt to detach, from 1 to 4. </p>
</li>
</ul>


<dl class="docutils">
<dt><em>See</em></dt>
<dd><a class="reference internal" href="lang/api/attachinterrupt.html#project0class_hardware_timer_1ae1965408f7b2ed72eaf37f35590a1e36"><em>HardwareTimer::attachInterrupt()</em></a> </dd>
</dl>
</p>
        </p>
</dd>
<dt id=""><span id="project0ext__interrupts_8h_1abacafe8ae080fe4515ae6927ce1003fc"></span><strong>ExtIntTriggerMode enum</strong></dt>
<dd><p class="first">
<p>The kind of transition on an external pin which should trigger an interrupt. </p>
        </p>
<p>
        </p>
<p><em>Values:</em></p>
<ul class="breatheenumvalues last">
<li><tt class="first docutils literal"><span class="pre">RISING</span></tt> - 
<p>To trigger an interrupt when the pin transitions LOW to HIGH. </p>
          
          </li>
<li><tt class="first docutils literal"><span class="pre">FALLING</span></tt> - 
<p>To trigger an interrupt when the pin transitions HIGH to LOW. </p>
          
          </li>
<li><tt class="first docutils literal"><span class="pre">CHANGE</span></tt> - 
<p>To trigger an interrupt when the pin transitions from LOW to HIGH or HIGH to LOW (i.e., when the pin changes). </p>
          
          </li>
</ul>
</dd>
<dt id=""><span id="project0libmaple__types_8h_1a44181537ab6ea5631069dcd97b51bcff"></span>typedef void(*  <strong>voidFuncPtr</strong>)(void)</dt>
<dd><p class="first">
        </p>
<p class="last">
        </p>
</dd>
</div>
<div class="section" id="code-example">
<h2>Code example<a class="headerlink" href="#code-example" title="Permalink to this headline">¶</a></h2>
<p>Blink the LED on every transition:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="kt">int</span> <span class="n">pin</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
<span class="k">volatile</span> <span class="kt">int</span> <span class="n">state</span> <span class="o">=</span> <span class="n">LOW</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">INPUT_FLOATING</span><span class="p">);</span>
  <span class="n">attachInterrupt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">blink</span><span class="p">,</span> <span class="n">CHANGE</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">blink</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">state</span> <span class="o">=</span> <span class="o">!</span><span class="n">state</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="recommended-reading">
<h2>Recommended Reading<a class="headerlink" href="#recommended-reading" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">STMicro documentation for STM32F103RB microcontroller:</p>
<blockquote>
<ul class="simple">
<li><a class="reference external" href="http://www.st.com/stonline/products/literature/ds/13587.pdf">Datasheet</a> (pdf)</li>
<li><a class="reference external" href="http://www.st.com/stonline/products/literature/rm/13902.pdf">Reference Manual</a> (pdf)</li>
</ul>
</blockquote>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/round_logo_60x60.png" alt="Logo"/>
            </a></p>
<h3><a href="index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="maple-quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="maple-ide-install.html">IDE Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ide.html">IDE Anatomy</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="language.html">Maple Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="libraries.html">Maple Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="compatibility.html">Arduino Compatibility</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">External Interrupts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#function-reference">Function Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code-example">Code example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#recommended-reading">Recommended Reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="libmaple.html">Command-Line Tools &amp; APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootloader.html">Bootloader</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="errata.html">Known Problems</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="i2c.html">I<sup>2</sup>C</a></li>
<li class="toctree-l1"><a class="reference internal" href="pwm.html">PWM</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpio.html">GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="usb.html">USB</a></li>
<li class="toctree-l1"><a class="reference internal" href="jtag.html">JTAG</a></li>
<li class="toctree-l1"><a class="reference internal" href="adc.html">ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="spi.html">SPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="usart.html">USART</a></li>
<li class="toctree-l1"><a class="reference internal" href="timers.html">Timers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="specs.html">Technical Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="language-index.html">Complete Language Index</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="libmaple.html" title="libmaple Reference"
             >next</a></li>
        <li class="right" >
          <a href="compatibility.html" title="Maple-Arduino Compatibility"
             >previous</a> |</li>
    <li><a href="http://leaflabs.com">LeafLabs</a> |</li>
    <li><a href="index.html">Docs Home</a> |</li>
    
        <li><a href="index.html">Index</a> &raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, LeafLabs, LLC.
      Last updated on Dec 15, 2010.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>
  </body>
</html>